{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Relato DermaSync",
  "type": "object",
  "required": ["id_relato", "conteudo_original"],
  "properties": {

    "id_relato": { "type": "string", "minLength": 10 },

    "versao_pipeline": {
      "type": ["string", "null"],
      "description": "Vers√£o do pipeline que processou o relato"
    },

    "origem": {
      "type": ["object", "null"],
      "properties": {
        "plataforma": {
          "type": "string",
          "enum": ["firestore", "facebook", "telegram", "reddit", "whatsapp", "local"]
        },
        "link": { "type": ["string", "null"] },
        "ano_postagem": { "type": ["integer", "null"] },
        "grupo": { "type": ["string", "null"] }
      }
    },

    "conteudo_original": { "type": "string", "minLength": 1 },
    "conteudo_anonimizado": { "type": ["string", "null"] },

    "classificacao_etaria": { "type": ["string", "null"] },
    "idade": { "type": ["integer", "string", "null"] },
    "genero": { "type": ["string", "null"] },

    "regioes_afetadas": { "type": "array", "items": { "type": "string" } },
    "sintomas": { "type": "array", "items": { "type": "string" } },

    "tags_extraidas": { "type": "array", "items": { "type": "string" } },

    "llm_processamento": {
      "type": ["object", "null"],
      "properties": {
        "inicio": { "type": "string", "format": "date-time" },
        "fim": { "type": "string", "format": "date-time" },
        "duracao_ms": { "type": "integer" },
        "tentativas": { "type": "integer" },
        "erro": { "type": ["string", "null"] }
      }
    },

    "imagens": {
      "type": ["object", "null"],
      "properties": {
        "antes": { "type": ["string", "null"] },
        "durante": { "type": "array", "items": { "type": "string" } },
        "depois": { "type": ["string", "null"] }
      }
    },

    "consentimento": {
      "type": ["object", "null"],
      "properties": {
        "public_display": { "type": "boolean" },
        "terms_version": { "type": "string" },
        "accepted_at": { "type": "string", "format": "date-time" }
      }
    },

    "public_visibility": {
      "type": ["object", "null"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["PRIVATE", "ELIGIBLE", "PUBLIC", "UNDER_REVIEW", "REJECTED"]
        },
        "reason": { "type": ["string", "null"] },
        "updated_at": { "type": "string", "format": "date-time" }
      }
    },

    "public_excerpt": {
      "type": ["object", "null"],
      "properties": {
        "text": { "type": "string", "maxLength": 120 },
        "age_range": { "type": ["string", "null"] },
        "duration": { "type": ["string", "null"] },
        "tags": { "type": "array", "items": { "type": "string" } },
        "image_preview_url": { "type": ["string", "null"] }
      }
    }
  },
  "additionalProperties": false
}
